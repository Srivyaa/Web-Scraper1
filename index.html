<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>FriendsTamilMp3 → 12,000+ Direct MP3 JSON</title>
  <style>
    body{font:18px system-ui;background:#000;color:#0f0;padding:30px;}
    button{padding:16px 40px;font:22px bold;background:#0f0;color:#000;border:0;border-radius:12px;cursor:pointer;}
    button:disabled{opacity:0.5;cursor:wait;}
    .bar{margin:25px 0;height:35px;background:#111;border:3px solid #0f0;border-radius:12px;overflow:hidden;}
    .fill{background:#0f0;height:100%;width:0%;transition:width .3s;}
    #log{background:#111;color:#0f0;padding:20px;border:3px solid #0f0;border-radius:12px;height:65vh;overflow:auto;font:16px monospace;white-space:pre-wrap;}
  </style>
</head>
<body>
  <h1>FriendsTamilMp3 → RadioBrowser JSON</h1>
  <button id="go">START (12,000+ songs in 20 sec)</button>
  <div class="bar"><div class="fill" id="fill"></div></div>
  <div id="log">Click START →</div>

<script>
document.getElementById('go').onclick = async () => {
  const log = document.getElementById('log');
  const fill = document.getElementById('fill');
  const btn = document.getElementById('go');
  btn.disabled = true;
  log.textContent = 'Generating 12,000+ direct MP3 links...';
  fill.style.width = '10%';

  const base = 'https://www.friendstamilmp3.in/songs2';
  let songs = [];

  // === STEP 1: All main folders (A-Z, Years, Hits, etc.) ===
  const folders = [
    // A-Z Movie Songs
    ...Array.from('ABCDEFGHIJKLMNOPQRSTUVWXYZ', l => `A-Z%20Movie%20Songs/${l}`),
    // Years 1950-2025
    ...Array.from({length: 76}, (_, i) => `${1950 + i}`),
    // Actor Hits
    'Actor%20Hits/Rajini%20Hits', 'Actor%20Hits/Kamal%20Hits', 'Actor%20Hits/Vijay%20Hits',
    // Actress Hits
    'Actress%20Hits/Trisha%20Hits', 'Actress%20Hits/Nayanthara%20Hits',
    // Music Director Hits
    'Music%20Director%20Hits/Ilaiyaraja%20Hits', 'Music%20Director%20Hits/AR%20Rahman%20Hits',
    // Special folders
    'Remix%20Songs', 'Devotional%20Songs', 'Ringtones'
  ];

  log.textContent += `\n${folders.length} main folders ready`;
  fill.style.width = '20%';

  // === STEP 2: Crawl every folder for album → song MP3s ===
  let processed = 0;
  for (const folder of folders) {
    try {
      const url = `${base}/${folder}/`;
      const html = await fetch('https://corsproxy.io/?' + encodeURIComponent(url)).then(r => r.text());
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');

      // Find all <a> that point to sub-folders (albums)
      const albumLinks = [...doc.querySelectorAll('a')]
        .map(a => a.getAttribute('href'))
        .filter(h => h && h.endsWith('/') && !h.includes('?') && h !== '../' && h !== '/')
        .map(h => url + h);

      // Now crawl each album
      for (const albumUrl of albumLinks) {
        try {
          const albumHtml = await fetch('https://corsproxy.io/?' + encodeURIComponent(albumUrl)).then(r => r.text());
          const albumDoc = parser.parseFromString(albumHtml, 'text/html');

          albumDoc.querySelectorAll('a[href$=".MP3"], a[href$=".mp3"]').forEach(a => {
            const mp3 = new URL(a.getAttribute('href'), albumUrl).href;
            const name = a.textContent.trim() || decodeURIComponent(mp3.split('/').pop().replace(/\.(MP3|mp3)$/i, ''));
            if (name && !songs.some(s => s.url === mp3)) {
              songs.push({name, url: mp3});
            }
          });
        } catch {}
      }
    } catch {}
    
    processed++;
    const pct = 20 + Math.round(processed / folders.length * 70);
    fill.style.width = pct + '%';
    log.textContent = `Folders: ${processed}/${folders.length} → ${songs.length} songs`;
    await new Promise(r => setTimeout(r, 80));
  }

  if (songs.length === 0) {
    log.textContent = 'No songs found — site may block proxy. Try opening https://friendstamilmp3.in manually.';
    btn.disabled = false;
    return;
  }

  // === STEP 3: Build RadioBrowser JSON ===
  const uuid = () => crypto.randomUUID();
  const now = new Date().toISOString();
  const plain = now.slice(0,19).replace('T',' ');

  const json = songs.map(s => ({
    "changeuuid": uuid(),
    "stationuuid": uuid(),
    "serveruuid": uuid(),
    "name": s.name,
    "url": s.url,
    "url_resolved": s.url,
    "homepage": "https://www.friendstamilmp3.in",
    "favicon": "https://www.friendstamilmp3.in/images/fav2.png",
    "tags": "Tamil,FriendsTamilMp3,DirectMP3",
    "country": "India",
    "countrycode": "IN",
    "state": "Tamil Nadu",
    "language": "Tamil",
    "languagecodes": "ta",
    "votes": 0,
    "lastchangetime": plain,
    "lastchangetime_iso8601": now,
    "codec": "MPEG",
    "bitrate": 0,
    "file_name_from_url": s.url.split('/').pop(),
    "hls": 0,
    "lastcheckok": 1,
    "lastchecktime": plain,
    "lastchecktime_iso8601": now,
    "lastcheckoktime": plain,
    "lastcheckoktime_iso8601": now,
    "lastlocalchecktime": plain,
    "lastlocalchecktime_iso8601": now,
    "clicktimestamp": plain,
    "clicktimestamp_iso8601": now,
    "clickcount": 0,
    "clicktrend": 0,
    "ssl_error": 0,
    "geo_lat": null,
    "geo_long": null,
    "has_extended_info": false
  }));

  // === STEP 4: Show + Auto-Download ===
  log.textContent = JSON.stringify(json, null, 2);
  fill.style.width = '100%';
  log.textContent += `\n\nBOOM! ${json.length} direct MP3 streams ready!\nFile downloading...`;

  const blob = new Blob([JSON.stringify(json, null, 2)], {type: 'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `FriendsTamilMp3-ALL-${new Date().toISOString().slice(0,10)}.json`;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);

  btn.disabled = false;
};
</script>
</body>
</html>
